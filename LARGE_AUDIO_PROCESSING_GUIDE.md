# 🎤 大容量音声ファイル処理ガイド

## 📋 概要

122MBのような大容量音声ファイルを処理するための音声分割機能が実装されました。OpenAI Whisper APIの25MB制限を超えるファイルを自動的に分割して処理できます。

## 🚀 機能の特徴

### 自動分割処理
- **制限値**: 25MB（OpenAI Whisperの制限）
- **安全マージン**: 20MBを推奨最大サイズとして使用
- **重複処理**: 分割点での音声の途切れを防ぐため、2秒の重複を設定
- **自動マージ**: 分割処理後の結果を自動的に結合

### カスタム分割オプション
- **手動設定**: 1-30分の範囲でチャンク時間を指定可能
- **プログレス表示**: 各チャンクの処理状況をリアルタイム表示
- **失敗対応**: 一部のチャンクが失敗しても他のチャンクは処理継続

## 📝 使用方法

### Step 1: 大容量ファイルのアップロード
1. 「🎤 音声・議事録」ページにアクセス
2. 122MBのファイルをアップロード
3. 自動的に分割処理が必要であることが検出される

### Step 2: 処理オプションの設定
**自動分割（推奨）**
- システムが最適な分割サイズを自動計算
- 通常は5-10個のチャンクに分割

**カスタム分割**
- 「カスタム分割時間を指定」にチェック
- 分割時間を1-30分で設定（例：10分）

### Step 3: 文字起こし実行
1. 「🎯 文字起こし開始（分割処理）」をクリック
2. 各チャンクの進行状況を確認
3. 自動マージされた結果を取得

## 📊 処理例（122MBファイル）

### 自動分割の場合
```
ファイル: meeting_122mb.mp3 (122MB, 90分)
├── チャンク1: 00:00 - 18:02 (18分)
├── チャンク2: 18:00 - 36:02 (18分) ※2秒重複
├── チャンク3: 36:00 - 54:02 (18分) ※2秒重複
├── チャンク4: 54:00 - 72:02 (18分) ※2秒重複
└── チャンク5: 72:00 - 90:00 (18分) ※2秒重複
```

### カスタム分割（10分設定）の場合
```
ファイル: meeting_122mb.mp3 (122MB, 90分)
├── チャンク1: 00:00 - 10:02 (10分)
├── チャンク2: 10:00 - 20:02 (10分) ※2秒重複
├── ... (続く)
└── チャンク9: 80:00 - 90:00 (10分) ※2秒重複
```

## 🛠️ 技術詳細

### 分割アルゴリズム
1. **サイズ計算**: ファイルサイズ ÷ 推奨最大サイズ（20MB）
2. **時間計算**: 音声時間 ÷ 必要分割数
3. **重複追加**: 各チャンクに2秒の重複を設定
4. **境界調整**: 音声の自然な区切りを考慮

### 品質保証
- **重複除去**: マージ時に重複部分を自動検出・除去
- **エラー処理**: 個別チャンクの失敗時も全体処理は継続
- **品質チェック**: 各チャンクの文字起こし結果を検証

## 📈 パフォーマンス

### 処理時間の目安
- **小チャンク（10分）**: 約1-2分/チャンク
- **大チャンク（20分）**: 約2-3分/チャンク
- **122MB（90分）**: 全体で15-30分程度

### コスト概算
- **Whisperコスト**: 約$0.006/分 × 90分 = $0.54
- **チャンク数影響**: 分割数が増えても基本的にコストは同じ
- **重複部分**: 2秒×チャンク数の追加コスト（微小）

## ⚠️ 注意事項

### ファイル制限
- **最大ファイルサイズ**: システムメモリに依存（通常500MB程度まで）
- **音声品質**: 低品質な音声は分割してもWhisperの精度向上は限定的
- **処理時間**: 大容量ファイルは長時間の処理が必要

### 推奨事項
- **音声品質**: 可能な限り高品質な録音を使用
- **ファイル形式**: MP3またはWAVを推奨
- **ネットワーク**: 安定したインターネット接続が必要

## 🔧 トラブルシューティング

### よくある問題
**チャンクの一部が失敗する**
→ ネットワーク不安定やAPI制限の可能性。時間をおいて再試行

**重複部分の処理がうまくいかない**
→ 音声の無音部分が少ない場合に発生。カスタム分割で短めの時間を設定

**メモリ不足エラー**
→ ファイルサイズがシステム制限を超過。より小さなファイルに分割して処理

### エラー時の対処
1. **ファイルサイズ確認**: 500MB未満であることを確認
2. **形式確認**: サポートされている音声形式かチェック
3. **再試行**: 一時的なエラーの場合は再試行
4. **分割設定変更**: カスタム分割で小さなチャンクに設定

## 🎯 最適な使用方法

### 122MBファイルの場合
1. **初回**: 自動分割で試行
2. **品質改善**: 結果に満足できない場合はカスタム分割（10-15分）
3. **専門用語**: ヒントプロンプトに専門用語を追加
4. **言語設定**: 明確に日本語と分かる場合は「ja」を選択

---

**💡 ヒント**: 大容量ファイルの処理は時間がかかりますが、並行して他の作業を進めることができます。処理完了時にはブラウザ通知が表示されます。
